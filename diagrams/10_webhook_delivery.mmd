%%{init: {'theme': 'dark'}}%%
sequenceDiagram
    participant E as ðŸ“¦ Event
    participant Q as ðŸ“‹ Queue
    participant W as ðŸ“¡ Webhook Service
    participant T as ðŸŽ¯ Target Server
    participant R as ðŸ”„ Retry Logic
    participant D as ðŸ’€ Dead Letter

    E->>Q: New event (conversion)
    Q->>W: Dequeue event
    
    W->>W: Sign payload (HMAC)
    W->>T: POST webhook
    
    alt Success (2xx)
        T-->>W: 200 OK
        W->>Q: Mark complete
    else Failure
        T-->>W: Error/Timeout
        W->>R: Schedule retry
        
        loop Retry attempts (1-8)
            R->>W: Retry delivery
            W->>T: POST webhook
            alt Success
                T-->>W: 200 OK
                W->>Q: Mark complete
            else Still failing
                R->>R: Increase delay
                Note over R: 5sâ†’10sâ†’30sâ†’1mâ†’5mâ†’30mâ†’1h
            end
        end
        
        R->>D: Move to DLQ
    end

